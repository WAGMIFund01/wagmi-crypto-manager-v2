# Auto Refresh Prices Workflow
name: Auto Refresh Prices

on:
  schedule:
    # Run every 30 minutes
    - cron: '*/30 * * * *'
  # Allow manual triggering
  workflow_dispatch:
  # Also run on push to test it
  push:
    branches: [ feature/automatic-price-refresh ]

jobs:
  refresh-prices:
    runs-on: ubuntu-latest
    
    steps:
      - name: Refresh Prices
        run: |
          echo "üîÑ Starting automatic price refresh..."
          
          # Get the production URL
          PRODUCTION_URL="https://wagmi-crypto-manager-v2.vercel.app"
          
          # Call the cron refresh endpoint
          echo "ÔøΩÔøΩ Calling cron refresh API..."
          REFRESH_RESPONSE=$(curl -s -X GET "$PRODUCTION_URL/api/cron/refresh-prices")
          echo "Refresh response: $REFRESH_RESPONSE"
          
          # Check if the call was successful
          if echo "$REFRESH_RESPONSE" | grep -q '"success":true'; then
            echo "‚úÖ Price refresh completed successfully!"
          else
            echo "‚ùå Price refresh failed!"
            exit 1
          fi
          
        env:
          # Add any environment variables you need
          NODE_ENV: production
